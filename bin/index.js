// Generated by CoffeeScript 1.6.2
(function() {
  var HackApiClient, client, cmd, prompt, stdincb;

  HackApiClient = require('../index.coffee');

  client = new HackApiClient;

  stdincb = void 0;

  cmd = {
    login: function() {
      process.stdin.write('username: ');
      return function(data) {
        var username;

        username = data.trim() || 'alee.chou@imagchina.com';
        process.stdin.write('password: ');
        return function(data) {
          var password;

          password = data.trim() || '111111';
          console.log("logining as " + username);
          return client.login(username, password, '', function(err, token) {
            if (err && err.message === 'verifycode') {
              console(log('需要输入验证码，验证码已保存至:' + err.localpath));
              process.stdin.write('verify code: ');
              return arguments.callee;
            } else {
              if (token) {
                console.log('login sucess, new token is ', token);
              } else {
                console.log('login fail');
              }
              if (err) {
                return console.log('error: ', err);
              }
            }
          });
        };
      };
    },
    help: function() {
      console.log('what are doing?');
      console.log('    login');
      console.log('    scan-user');
      return console.log('    scan-message');
    }
  };

  process.stdin.resume();

  process.stdin.on('data', function(data) {
    var newcb;

    data = data.toString();
    if (stdincb) {
      newcb = stdincb(data);
    } else {
      data = data.trim();
      cmd[data] && (newcb = cmd[data]());
    }
    stdincb = typeof newcb === 'function' ? newcb : void 0;
    if (!stdincb) {
      return prompt();
    }
  });

  prompt = function() {
    return process.stdin.write(' > ');
  };

  console.log("this is wechat hack-api");

  cmd.help();

  prompt();

}).call(this);
